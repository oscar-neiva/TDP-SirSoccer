%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%2345678901234567890123456789012345678901234567890123456789012345678901234567890
%        1         2         3         4         5         6         7         8

\documentclass[letterpaper, 10 pt, conference]{ieeeconf}  % Comment this line out if you need a4paper

%\documentclass[a4paper, 10pt, conference]{ieeeconf}      % Use this line for a4 paper

\IEEEoverridecommandlockouts                              % This command is only needed if 
                                                          % you want to use the \thanks command
\overrideIEEEmargins                                      % Needed to meet printer requirements.

% See the \addtolength command later in the file to balance the column lengths
% on the last page of the document

% The following packages can be found on http:\\www.ctan.org
\usepackage{graphics} % for pdf, bitmapped graphics files
\usepackage{epsfig} % for postscript graphics files
%\usepackage{mathptmx} % assumes new font selection scheme installed
%\usepackage{times} % assumes new font selection scheme installed
\usepackage{amsmath} % assumes amsmath package installed
%\usepackage{amssymb}  % assumes amsmath package installed
\usepackage[latin1]{inputenc}
%\usepackage[utf8]{inputenc}
\usepackage[english]{babel}
\usepackage{url}

\addto{\captionsenglish}{\renewcommand{\abstract}{\bf \small \textit{Resumo---}}}

\title{\LARGE \bf
	Descrição do Time de Futebol de Robôs da Equipe SIRSoccer para a Categoria \textit{IEEE Very Small Size Soccer}
}

\author{
	Johnathan Fercher da Rosa$^{2}$, Lucas Borsatto Simão$^{1}$, Hebert Luiz Cabral da Silva$^{1}$, 
	\\Felipe de Mello Amaral$^{1}$, Pedro Mello$^{1}$, Hiago Guedes$^{1}$
	\\Alberto Torres Angonese$^{1,2}$ e Eduardo Krempser da Silva$^{1,3}$
	\thanks{*Este trabalho é apoiado pelo Laboratório de Sistemas Inteligentes e Robótica -- SIRLab, pela Faculdade de Educação Tecnológica do Estado do Rio de Janeiro -- FAETERJ e pelo Laboratório Nacional de Computação Científica -- LNCC}% <-this % stops a space
	\thanks{$^{1}$Faculdade de Educação Tecnológia do Estado do Rio de Janeiro - FAETERJ}%
	\thanks{$^{2}$Instituto Militar de Engenharia - IME}%
	\thanks{$^{3}$Fundação Oswaldo Cruz - Fiocruz}%
}

\begin{document}
\maketitle
\thispagestyle{empty}
\pagestyle{empty}

\begin{abstract}
	Neste \textit{Team Description Paper - TDP} são apresentados os resultados do trabalho realizado em 2016 pela equipe SIRSoccer. O objetivo é descrever o desenvolvimento de uma plataforma de futebol de robôs da categoria IEEE \textit{Very Small Size Soccer - VSSS}, para participação na XIV Competiç\~ao Brasileira de Rob\'otica - CBR e na XV Competiç\~ao Latino Americana de Robótica - LARC. São descritos os trabalhos de todas as etapas de construção do time. Com destaque para a construção de um \textit{Framework} desenvolvido para a categoria e da Transmissão dos robôs, uma vez que estas foram as partes com maior evolução durantes os trabalhos este ano. 
\end{abstract}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{INTRODUÇÃO}
A Faculdade de Educação Tecnológica do Estado do Rio de Janeiro - FAETERJ/Petrópolis, possui o curso superior de Tecnologia da Informação e de Comunicação, em que além das disciplinas tecnológicas previstas no currículo, os alunos também participam de outras atividades, de forma a contribuir para a formação acadêmica. O Laboratório de Sistemas Inteligentes e Robótica - SIRLab, surge com a ideia de proporcionar um ambiente para prática e estudo em computação, robótica e inteligência computacional.

A IEEE \textit{Very Small Size Soccer - VSSS} é uma categoria de futebol de robôs \cite{ferreira2013desenvolvimento} que proporciona o estudo em diversas áreas. O time de robôs que jogam futebol trata-se de um sistema autônomo com um servidor e três agentes que executam ações determinadas por este servidor. As informações de jogo chegam ao servidor por meio de imagens, estas fornecidas por uma câmera que fica instalada a 2$m$ ou mais da base do campo. As informações são processadas pelo servidor e em seguida um comando é enviado aos robôs por rádio frequência.

O sistema de um time de futebol de robôs IEEE VSSS é cooperativo e atua em um ambiente altamente dinâmico, o que faz do seu desenvolvimento algo muito complexo. As seções deste artigo estão divididas conforme as linhas de estudo necessárias para o desenvolvimento do trabalho. No desenvolvimento do projeto foram necessários estudos em visão computacional, sistemas e controle, redes e eletrônica. Assim, o trabalho feito será apresentado partindo do novo \textit{Framework} criado pela equipe até o \textit{hardware} do robô.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{FRAMEWORK}
%\label{framework}
Atualmente o laboratório vem trabalhando na integração das ferramentas desenvolvidas durante esses anos de trabalho, foi desenvolvido, inspirado na arquitetura fornecida para os competidores das categorias Small Size League (SSL) \cite{ssl-vision} e RoboCup 2D Soccer Simulation, programas separados e fechados de forma que os novos integrantes do laboratório possam se preocupar apenas com a construção e aprimoramento do \textit{software} de inteligência. 

Utilizando as bibliotecas Protobuf e ZMQ, foi criado um protocolo de comunicação, com a finalidade de padronizar os fluxos de entrada e saída de dados entre os seguintes programas: \textit{Software} de Visão Computacional (VSS-Vision), Simulador da categoria IEEE VSS (VSS-Simulator), (Visualizador de Estados) VSS-Viewer e (Núcleo de Estratégia) VSS-SampleStrategy. 
Atualmente uma estratégia/inteligência escrita aos moldes do VSS-SampleStrategy funciona sem necessidades de adaptação com os demais projetos, assim facilitando a integração e o desenvolvimento.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{VSS-Vision}
%\label{vss-vision}
O novo sistema de visão computacional VSS-Vision, (Figura~\ref{vss-vision}), utiliza a biblioteca OpenCV \cite{bradski2000opencv} e faz uso do padrão de cores HSV para captação e filtragem de imagens. A OpenCV é uma biblioteca livre, sob a licença de código aberto BSD (\textit{Berkeley Software Distribution}). A biblioteca pode ser implementada em Python, C++ e outras linguagens, porém, dado que todo o restante do sistema está implementado em C++, optou-se por essa linguagem \cite{stroustrup1995c++}.

\
\begin{figure}[!htb]
	\centering
	\includegraphics[width=0.4\textwidth]{figures/vss-vision}
	\caption{VSS-Vision em Execução}
	\label{vss-vision}
\end{figure}

O programa localiza na imagem as cores desejadas, e faz a distinção dos objetos do jogo. E para o tratamento das imagens captadas são usados alguns filtros da biblioteca \cite{jfercher}. O sistema obteve avanços, uma vez que com o uso do HSV ao invés do RGB, os problemas relacionados ao gradiente de luminosidade foram resolvidos. Pode ser visto em \cite{ohta1987computer}, um estudo comparativo de diversos sistemas de cores aplicados à segmentação por cor, onde o modelo HSV apresentou informações de cor e luminância mais descorrelacionadas que no modelo RGB. Com isso, o modelo HSV mostra-se mais adequado para segmentação baseada em cores. E ap\'os a mudança no programa, o sistema está mais robusto a variaç\~oes luminosas.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{VSS-Simulator}
%\label{vss-simulator}
O simulador VSS-Simulator, ilustrado em (Figura~\ref{vss-simulator}), foi criado pela equipe do laboratório SIRLab para a categoria VSSS com o objetivo de facilitar a criação de estratégias que podem ser implementadas pelos robôs. O padrão de projeto utilizado garante que, mesmo que o código seja feito pelo simulador, ele irá funcionar também para a plataforma física da categoria, de forma que é possível que os integrantes realizem seus progressos na estratégia e apenas tenham que migrar o código para que possa ser executado nos robôs.

\
\begin{figure}[!htb]
	\centering
	\includegraphics[width=0.4\textwidth]{figures/vss-simulator}
	\caption{Janela Gráfica de Execução do VSS-Simulator}
	\label{vss-simulator}
\end{figure}

Isso é possível devido a modulação do projeto, que é dividido em partes físicas, gráficas e de estratégia. A parte física fornece os mesmos dados que a plataforma com a câmera, de modo que, garantido que os dados vão abastecer as outras partes da mesma maneira, é possível o desenvolvimento independente.

O simulador é desenvolvido com o apoio das bibliotecas de OpenGL \cite{glut}, responsáveis pela parte gráfica, e com a versão 2.83 da Bullet Physics \cite{bullet}, que tem a função de simular toda a física da plataforma. A Bullet funciona com base nos intervalos de tempo que um ciclo do OpenGL leva para poder ser processado, fazendo com que o processamento físico seja sincronizado com o processamento gráfico, sendo realizado logo depois. Os robôs são criados via Bullet, que então fica responsável pela sua movimentação. Essa parte é executada com base nos dados que a estratégia do simulador define, determinando a velocidade que as rodas do robô devem atingir para que possa alcançar o ponto de destino desejado, de forma que fica a critério do desenvolvedor determinar qual a rota que o robô irá adotar.

O desenvolvimento da plataforma de simulação requer alguns cuidados, pois a própria Bullet possui um sistema de veículos próprios, mas que teve que ser modificado pela equipe para que pudesse ser compatível ao modelo da categoria VSSS. Um exemplo técnico disso é o sistema de movimentação dos veículos dentro da biblioteca, que ocorre com base em um sistema de coordenadas relativa ao sistema cartesiano externo, e não relativo ao próprio veículo.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{SISTEMA E CONTROLE}
%\label{sistema}
Os robôs da categoria IEEE \textit{Very Small Size Soccer} são do tipo diferenciais \cite{siciliano2002springer} e não holonômicos (Figura~\ref{sistema}). Sendo a holonomia o conjunto de vínculos relacionados a mecânica onde há dependências apenas relacionadas às coordenadas espaciais que definem o sistema. E o termo diferencial faz referência ao modelo de robôs com duas rodas que não são capazes de se movimentar livremente em todas as coordenadas espaciais sem que mudem suas angulações.

\
\begin{figure}[!htb]
	\centering
	\includegraphics[width=0.4\textwidth]{figures/sistema}
	\caption{Modelo \textit{Differential Driver}}
	\label{sistema}
\end{figure}

As equações cinemáticas de um robô da categoria VSSS são equivalentes ao modelo de um uni ciclo. Robôs com tal arquitetura tem uma descrição não holonômica e cinemática de forma \cite{blazic2014periodic}:

\begin{equation}
		\dot{q} = \begin{pmatrix}
 		\dot{x}\\
		\dot{y}\\
 		\dot{\theta}\\
	\end{pmatrix} = 
	\begin{pmatrix}
 		cos\theta & 0\\
		sen\theta & 0\\
 		0 & 1\\
	\end{pmatrix}
	\begin{pmatrix}
 		v\\
		\omega\\
	\end{pmatrix}
\end{equation}.

Sendo $\dot{q}$ a pose atual do sistema, $\dot{x}$ e $\dot{y}$ as componentes da velocidade tangencial em $\dot{x}$ e $\dot{y}$, $\dot{\theta}$ a angulação do robô e $v$ e $\omega$ as velocidades tangencial e angular, respectivamente. Através da velocidade tangencial calculada no modelo (1), é feita a estimação das velocidades tangenciais para cada uma das rodas pelas equações \eqref{ve} e \eqref{vd}.   

\begin{equation}\label{ve}
	v_e = v - \frac{\omega B}{2}
\end{equation}

\begin{equation}\label{vd}
	v_d = v + \frac{\omega B}{2}
\end{equation}

Para concluir-se que o sistema se comporta como deveria é necessário que os sensores retornem precisamente os valores que foram calculados na estratégia, ou seja, os valores retornados pelos sensores devem estar próximos a chamada referência para que o sistema esteja bem comportado. Sendo assim, enquanto uma ou mais variáveis não conseguem alcançar a referência, ao longo do tempo, um controlador manipula as entradas do sistema para obter o efeito desejado nas saídas. 

A equipe vem estudando diversas formas de controlar as variações abruptas do sistema, no entanto, ainda não chegou-se a nenhum modelo de controle adequado a esta aplicação.   

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{TRANSMISSÃO}
%\label{transmissao}
A rede do time de futebol de robôs da SIRSoccer possui uma topologia do tipo estrela. O coordenador é configurado em modo \textit{broadcast}, e os pacotes são transmitidos em massa para os três robôs, que fazem a interpretação do pacote e executam apenas o trecho da mensagem destinado a cada um deles.

A rede é composta por três receptores configurados como \textit{end-point}, e um transmissor principal configurado como coordenador \cite{ZigbeeSite}. A frequência operante dos rádios XBee S3 (Figura~\ref{xbee-s3}) podem ser definidas de 902$Mhz$ (IEEE 802.15.4) até 928$Mhz$ (IEEE 802.15.4), diferente da versão anterior usada pela equipe em suas primeiras participações, que operava em 2.4$Ghz$ (IEEE 802.11$x$) como frequência padrão. 

\
\begin{figure}[!htb]
	\centering
	\includegraphics[width=0.4\textwidth]{figures/xbee-s3}
	\caption{XBee Pro S3B}
	\label{xbee-s3}
\end{figure}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{HARDWARE}
%\label{hardware}
Os componentes base para o desenvolvimento da plataforma foram o rádio Digi Xbee S3B \cite{XBee}, o microcontrolador Arduino Micro \cite{Arduino}, o circuito integrado da Toshiba TB6612FNG \cite{Toshiba}, os micro-motores da pololu \cite{Pololu} e seus \textit{encoders} \cite{Encoder} ópticos para micro motores. Foi então projetada uma placa dedicada a interconexão dos componentes básicos da plataforma, como mostra a (Figura~\ref{pinagem}), de modo a poupar espaço e a proporcionar melhor aproveitamento de baterias evitando que componentes que não estão sendo usados promovam gastos excessivos no sistema eletrônico.

\
\begin{figure}[!htb]
	\centering
	\includegraphics[width=0.4\textwidth]{figures/pinagem}
	\caption{Componentes do Hardware dos Robôs SIRSoccer}
	\label{pinagem}
\end{figure}

Para receber as informações do servidor, o sistema robótico dispões de um rádio RF XBee S3B, circuito este responsável por transpor a comunicação de baixo nível lógico do XBee para o nível lógico do micro-controlador. A decodificação da informação recebida é feita pelo microcontrolador Arduino Micro, que vai enviar os comandos de movimentação para uma ponte-h \cite{Ponte-H} dupla da Toshiba, modelo TB6612FNG. Por fim, esta será responsável por transformar os comandos básicos de movimentação em pulsos para os motores \cite{pwm}.

\
\begin{figure}[!htb]
	\centering
	\includegraphics[width=0.4\textwidth]{figures/encoder}
	\caption{Motor de relaç\~ao 1:50 com encoder}
	\label{encoder}
\end{figure}

Assim, com o espaço poupado pela utilização de uma placa única, foi possível usar duas baterias que somam um total de 2000mAh e operam em uma voltagem de 7,4V. E ainda foi possível utilizar \textit{encoders} (Figura~\ref{encoder}) nos micro motores para que atrav\'es das leituras de velocidade de rotaç\~ao fosse possível implementar um controle embarcado. 

A motivação para criação desta placa advém de experiencias da equipe em competições anteriores. O uso de \textit{shields} \cite{DFRobots} pré-moldados com pinagens de fácil integração entre \textit{drivers} de motor, dispositivos de rádio frequência e microcontroladores  foram essenciais para que a equipe pudesse em um primeiro momento ter outras preocupações. No entanto, com o desenvolver do projeto, a busca por uma melhor desempenho dos robôs (Figura~\ref{robo-a}) tem se mostrado essencial.

\
\begin{figure}[!htb]
	\centering
	\includegraphics[width=0.4\textwidth]{figures/robo-a}
	\caption{Rob\^o SIRSoccer}
	\label{robo-a}
\end{figure}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{CONCLUSÃO}
%\label{conclusao}
Durante os trabalhos em 2016, a equipe SIRSoccer estudou técnicas e modelos para aperfeiçoar seu time de futebol de robôs \textit{Very Small Size Soccer}. Dentre os avanços obtidos este ano, destaca-se o início de estudos mais aprofundados em sistemas e controle, a criação de uma placa e termino do desenvolvimento do simulador. Planos já estão sendo traçados para as futuras participações da equipe na LARC, e este ano espera-se obter resultados ainda mais satisfatórios que nas edições anteriores.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%\section*{APÊNDICE}
%\label{apendice}
%\subsection{UM APENDICE} %Isso é pra criar um A.nome do apêndice.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{AGRADECIMENTOS}
A equipe SIRSoccer agradece a Faculdade de Educação Tecnológica do Estado do Rio de Janeiro (FAETERJ - Petrópolis) pelo apoio.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\bibliographystyle{unsrt}
\footnotesize\bibliography{sirlab}		

\end{document}
